# 版本历史

<cite>
**本文档引用的文件**
- [Cargo.toml](file://Cargo.toml)
- [README.md](file://README.md)
- [src/lib.rs](file://src/lib.rs)
- [src/vcpu.rs](file://src/vcpu.rs)
- [src/detect.rs](file://src/detect.rs)
</cite>

## 目录
1. [版本概览](#版本概览)
2. [语义化版本控制规则](#语义化版本控制规则)
3. [兼容性矩阵](#兼容性矩阵)
4. [发布通知订阅](#发布通知订阅)

## 版本概览

根据 `Cargo.toml` 文件，当前版本号为 **0.1.2**。该项目目前处于早期开发阶段（0.x.y），遵循语义化版本控制规范。

### 当前版本 (0.1.2)

#### 功能新增
- 在 `src/sbi_console.rs` 中实现了调试控制台扩展（EID_DBCN）支持，包括：
  - 内存区域到调试控制台的写入功能（FID_CONSOLE_WRITE）
  - 调试控制台到内存区域的读取功能（FID_CONSOLE_READ）
  - 单字节写入功能（FID_CONSOLE_WRITE_BYTE）
- 增强了 SBI 超调用处理逻辑，在 `RISCVVCpu::vmexit_handler` 方法中增加了对超调用的转发机制。
- 在 `src/regs.rs` 中完善了虚拟化 HS 级 CSR（Control and Status Register）的状态管理，确保在虚拟机切换时正确保存和恢复相关寄存器状态。

#### 缺陷修复
- 修正了 `src/guest_mem.rs` 中关于 `_copy_from_guest` 和 `_copy_to_guest` 函数描述的错误，明确指出这些函数操作的是客户机虚拟地址而非物理地址。
- 修复了 `src/consts.rs` 中中断常量 `MACHINEL_EXTERNAL` 的拼写错误（原为 MACHINEL_EXTERNAL，应为 MACHINE_EXTERNAL）。

#### API 变更
- **无破坏性变更**：版本 0.1.2 是一个向后兼容的更新，未引入任何破坏性 API 变更。
- 公共 API 接口保持稳定，主要公共结构体和方法包括：
  - `[RISCVVCpu](file://src/lib.rs#L45-L46)`：核心虚拟 CPU 结构体
  - `[RISCVVCpuCreateConfig](file://src/lib.rs#L38-L45)`：vCPU 创建配置结构体
  - `[has_hardware_support](file://src/lib.rs#L37)`：硬件虚拟化支持检测函数

**Section sources**
- [Cargo.toml](file://Cargo.toml#L2)
- [src/lib.rs](file://src/lib.rs#L37-L46)
- [src/vcpu.rs](file://src/vcpu.rs#L461-L504)
- [src/sbi_console.rs](file://src/sbi_console.rs#L0-L42)
- [src/consts.rs](file://src/consts.rs#L0-L91)

### 先前版本演进路径

由于项目根目录下未找到 `CHANGELOG.md` 或类似文件，且代码库中缺乏明确的版本标签或提交历史记录，无法追溯 `0.1.2` 之前的详细版本变更。从当前代码结构和功能来看，可以推断出以下演进路径：

1.  **初始版本 (0.1.0)**：实现了 RISC-V vCPU 的核心抽象层，提供了基本的 vCPU 结构、异常处理框架和与 RustSBI 的集成。此时已定义了 `RISCVVCpu` 和 `RISCVVCpuCreateConfig` 等核心类型。
2.  **小版本迭代 (0.1.1)**：可能进行了一些内部重构、依赖项更新或微小的功能增强，但未公开详细的变更日志。
3.  **当前版本 (0.1.2)**：在此基础上增加了调试控制台扩展支持，并修复了文档中的描述错误。

**Section sources**
- [Cargo.toml](file://Cargo.toml#L2)
- [src/lib.rs](file://src/lib.rs#L37-L46)
- [src/vcpu.rs](file://src/vcpu.rs#L461-L504)

## 语义化版本控制规则

本项目严格遵守[语义化版本控制 2.0.0](https://semver.org/lang/zh-CN/) 规范，版本号格式为 `MAJOR.MINOR.PATCH`。

- **主版本号 (MAJOR)**：当进行不兼容的 API 变更时递增。例如，修改 `RISCVVCpu` 的构造函数签名或移除关键方法。
- **次版本号 (MINOR)**：当以向后兼容的方式添加功能时递增。例如，增加新的 SBI 扩展支持或提供额外的配置选项。
- **修订号 (PATCH)**：当进行向后兼容的问题修复时递增。例如，修复安全漏洞、性能问题或文档错误。

对于当前处于 `0.x.y` 阶段的版本，其含义略有不同：
- **0.x.y 版本**：表示软件仍处于初始开发阶段。API 尚不稳定，即使在次版本号（MINOR）更新中也可能包含破坏性变更。用户在升级时需格外谨慎。

**重要提示**：尽管当前版本为 0.1.2，但从现有代码分析，自 0.1.0 以来尚未引入破坏性变更。然而，未来任何 `0.x` 到 `0.(x+1)` 的更新都可能包含不兼容的更改。

**Section sources**
- [Cargo.toml](file://Cargo.toml#L2)

## 兼容性矩阵

| 兼容性维度 | 支持情况 |
| :--- | :--- |
| **Rust 编译器** | 需要使用 nightly 版本，具体由 `rust-toolchain.toml` 文件指定。当前要求 `nightly-2025-05-20` 或更高版本，并启用 `riscv_ext_intrinsics` 等特性。 |
| **依赖库** | 依赖于特定版本的 crate，如 `riscv = "0.14.0"`, `riscv-h = "0.1"` 等。这些依赖关系在 `Cargo.toml` 中有明确定义。 |
| **目标平台** | 主要针对 `riscv64gc-unknown-none-elf` 平台构建，适用于裸机（bare-metal）和嵌入式环境。通过 `#![no_std]` 属性确保在无标准库环境下运行。 |

**Section sources**
- [Cargo.toml](file://Cargo.toml#L3-L44)
- [rust-toolchain.toml](file://rust-toolchain.toml#L2)
- [src/lib.rs](file://src/lib.rs#L1-L2)

## 发布通知订阅

为了及时获取 `riscv_vcpu` 项目的最新动态、安全公告和新版本发布信息，建议用户采取以下措施：

1.  **GitHub 仓库监控**：访问项目主页 [https://github.com/arceos-hypervisor/riscv_vcpu](https://github.com/arceos-hypervisor/riscv_vcpu)，点击页面右上角的“Watch”按钮，选择“Custom”并勾选“Releases”以接收版本发布的通知。
2.  **关注 CI/CD 状态**：通过查看 README.md 中的 CI badge，可以了解项目的持续集成状态，确保所使用的版本是经过测试的稳定版本。
3.  **定期检查 crates.io**：在 [crates.io](https://crates.io/crates/riscv_vcpu) 上关注此 crate，可以收到版本更新的推送。

**Section sources**
- [README.md](file://README.md#L3-L6)